<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="utf-8">
    <title>Gestion CV Sopra Steria</title>
    <link rel="stylesheet" href="./style.css">

<body>

    <div class="header">
        <h3>Bienvenue sur l'IHM de Gestion de CV Sopra Steria</h3>
    </div>

    <div class="middle">
        <label class="switch">
            <input type="checkbox" id="FuzzyState" onclick="CheckState()">
            <span class="slider round"></span>
        </label>
        <p> Activer la fonction fuzzy wuzzy</p>
    </div>

    <div class="footer">
        <input type="file" name="upfile" />
        <button class="validate" type="button" onclick="SendPost()"><a>Valider</a></button>
    </div>
    <div>
        <button class="validate" type="button" onclick="afficherLocalStorage()"><a>afficher local storage</a></button>
        <button class="validate" type="button" onclick="EmptyLocalStorage()"><a>vider local storage</a></button>
        <button class="validate" type="button" onclick="getResult()"><a>Get r√©sultat</a></button>
    </div>

</body>


<script>

    window.onload = function () {

    };

    function CheckState() {
        var chkBox = document.getElementById('FuzzyState');
        console.log(chkBox.checked);
    }

    function afficherLocalStorage() {
        localJson = JSON.parse(localStorage.getItem('resumes_parsed'));
        console.log(localJson);
    }

    function EmptyLocalStorage() {
        localStorage.removeItem('resumes_parsed');

    }
    function getResult(){
        console.log("inside getResult");
        fetch("http://127.0.0.1:2000/resume-parser")
        .then(response => response.json())
        .then(data => console.log(data))
        .catch(error => console.error(error));
    }

    function SendPost() {
        console.log("inside SendPost");
        var fileInput = document.querySelector('input[type="file"]')
        var formdata = new FormData();
        formdata.append("files[]", fileInput.files[0]);
        var chkBox = document.getElementById('FuzzyState');
        formdata.append("fuzzy", chkBox.checked.toString());

        var requestOptions = {
            method: 'POST',
            body: formdata,
            redirect: 'follow'
        };
        event.preventDefault();
        fetch("http://127.0.0.1:2000/resume-parser?files[]=", requestOptions)
            .then(response => response.json())
            .then(result => {
                console.log(result);
                localStorage.setItem("resumes_parsed", JSON.stringify(result));
                window.open("/Front/uploadPage/upload.html", '_blank');

            })
            .catch(error => console.log('error', error));

    }





</script>